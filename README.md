# üè¶ –ë–∞–Ω–∫–æ–≤—Å–∫–∏–π REST API –Ω–∞ Go

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, —Ä–µ–∞–ª–∏–∑—É—é—â–µ–µ REST API –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞–º–∏ –∏ –∫–∞—Ä—Ç–∞–º–∏, –ø–µ—Ä–µ–≤–æ–¥—ã, –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–æ–≤, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞, –∞–≤—Ç–æ—à–µ–¥—É–ª–µ—Ä –ø–ª–∞—Ç–µ–∂–µ–π –∏ email-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.  
–°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ Docker Compose.

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. **–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π:**
   ```bash
   docker-compose up --build -d
   ```

2. **–î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º:**
   - API: [http://localhost:8080/api](http://localhost:8080/api)
   - –ü–æ—á—Ç–∞ (Mailhog): [http://localhost:8025](http://localhost:8025)

3. **–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:**
   ```bash
   docker-compose logs app
   docker-compose logs migrate
   docker-compose logs db
   ```

---

## –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

- `POST /api/register` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  
  **body**: `{ "Email": "...", "Password": "..." }`  
  –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å email.

- `POST /api/login` ‚Äî –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –ø–æ–ª—É—á–µ–Ω–∏–µ JWT  
  **body**: `{ "Email": "...", "Password": "..." }`  
  **response**: `{ "token": "..." }`  

JWT –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 24 —á–∞—Å–∞ –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization: Bearer <token>`.

---

### –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–Ω–∫–æ–≤—Å–∫–∏–º–∏ —Å—á–µ—Ç–∞–º–∏

- `POST /api/accounts` ‚Äî —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å—á—ë—Ç  
- `GET /api/accounts` ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–≤–æ–∏—Ö —Å—á–µ—Ç–æ–≤  
- `POST /api/accounts/deposit` ‚Äî –≤–Ω–µ—Å—Ç–∏/—Å–Ω—è—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞  
  **body**: `{ "account_id": ..., "amount": ... }`  
  (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî —Å–ø–∏—Å–∞–Ω–∏–µ)

- `POST /api/transfer` ‚Äî –ø–µ—Ä–µ–≤–æ–¥ –º–µ–∂–¥—É —Å–≤–æ–∏–º–∏ —Å—á–µ—Ç–∞–º–∏  
  **body**: `{ "from_id": ..., "to_id": ..., "amount": ... }`

---

### –†–∞–±–æ—Ç–∞ —Å –∫–∞—Ä—Ç–∞–º–∏

- `POST /api/cards` ‚Äî –≤—ã–ø—É—Å—Ç–∏—Ç—å –∫–∞—Ä—Ç—É –∫ —Å—á—ë—Ç—É  
  **body**: `{ "account_id": ..., "number": "...", "exp": "...", "cvv": "..." }`  
  –ï—Å–ª–∏ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ ‚Äî —Å–≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –ø–æ –∞–ª–≥–æ—Ä–∏—Ç–º—É –õ—É–Ω–∞).  
  –í—Å–µ –¥–∞–Ω–Ω—ã–µ —à–∏—Ñ—Ä—É—é—Ç—Å—è PGP + HMAC.

- `GET /api/cards` ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç —Å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–æ–π

---

### –ö—Ä–µ–¥–∏—Ç–æ–≤–∞–Ω–∏–µ

- `POST /api/credits` ‚Äî –æ—Ñ–æ—Ä–º–∏—Ç—å –∫—Ä–µ–¥–∏—Ç  
  **body**:
  ```json
  {
    "account_id": ...,
    "principal": ...,
    "rate": ...,
    "term_months": ...,
    "margin": ...
  }
  ```

- `GET /api/credits/{id}/schedule` ‚Äî –≥—Ä–∞—Ñ–∏–∫ –∞–Ω–Ω—É–∏—Ç–µ—Ç–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π  

- –®–µ–¥—É–ª–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–ø–∏—Å—ã–≤–∞–µ—Ç –ø–ª–∞—Ç–µ–∂–∏ (–∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤).  
- –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–µ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è —à—Ç—Ä–∞—Ñ (+10% –∫ –ø–ª–∞—Ç–µ–∂—É).

---

### –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

- `GET /api/analytics/month` ‚Äî –¥–æ—Ö–æ–¥—ã/—Ä–∞—Å—Ö–æ–¥—ã –ø–æ –º–µ—Å—è—Ü–∞–º  
- `GET /api/analytics/credit` ‚Äî —Ç–µ–∫—É—â–∞—è –∫—Ä–µ–¥–∏—Ç–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞  
- `GET /api/analytics/predict?days=N` ‚Äî –ø—Ä–æ–≥–Ω–æ–∑ –±–∞–ª–∞–Ω—Å–∞ —Å —É—á—ë—Ç–æ–º –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–¥–æ 365 –¥–Ω–µ–π)

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

- **–¶–ë –†–§**: SOAP-–∑–∞–ø—Ä–æ—Å—ã –∫ [DailyInfo.asmx](https://www.cbr.ru/DailyInfoWebServ/DailyInfo.asmx) –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∫–ª—é—á–µ–≤–æ–π —Å—Ç–∞–≤–∫–∏  
- **Email**: —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∫—Ä–µ–¥–∏—Ç–∞—Ö/–ø–ª–∞—Ç–µ–∂–∞—Ö —á–µ—Ä–µ–∑ SMTP (Mailhog)

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- JWT —Å —Å–µ–∫—Ä–µ—Ç–æ–º `JWT_SECRET`
- –ü–∞—Ä–æ–ª–∏: —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `bcrypt`
- –ö–∞—Ä—Ç—ã: —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–∞/—Å—Ä–æ–∫–∞ —á–µ—Ä–µ–∑ PGP, CVV ‚Äî —Ö–µ—à —á–µ—Ä–µ–∑ `bcrypt`, –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ –∞–ª–≥–æ—Ä–∏—Ç–º—É –õ—É–Ω–∞
- HMAC –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
- –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ —Å–≤–æ–∏–º –¥–∞–Ω–Ω—ã–º (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Å—á—ë—Ç–∞/–∫–∞—Ä—Ç—ã)
- Middleware: –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è JWT, –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

- **–Ø–∑—ã–∫**: Go 1.23+  
- **–ë–î**: PostgreSQL 17 + pgcrypto

### –°–ª–æ–∏:

- **–ú–æ–¥–µ–ª–∏**: —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö, JSON –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
- **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏**: SQL-–∑–∞–ø—Ä–æ—Å—ã, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∑–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π
- **–°–µ—Ä–≤–∏—Å—ã**: –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (SMTP, –¶–ë), —à–µ–¥—É–ª–µ—Ä
- **–•–µ–Ω–¥–ª–µ—Ä—ã**: –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –≤—ã–∑–æ–≤ —Å–µ—Ä–≤–∏—Å–æ–≤, —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤
- **Middleware**: JWT-–ø—Ä–æ–≤–µ—Ä–∫–∞, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–º–∏–Ω–∏–º—É–º)

- `users` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏  
- `accounts` ‚Äî –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Å—á–µ—Ç–∞  
- `cards` ‚Äî –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç  
- `transactions` ‚Äî –∏—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π  
- `credits` ‚Äî –∫—Ä–µ–¥–∏—Ç—ã  
- `payment_schedules` ‚Äî –≥—Ä–∞—Ñ–∏–∫ –ø–ª–∞—Ç–µ–∂–µ–π

---

## –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

| –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ              | –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞                      |
|------------------------|---------------------------------|
| –†–æ—É—Ç–∏–Ω–≥                | `gorilla/mux`                  |
| –†–∞–±–æ—Ç–∞ —Å –ë–î            | `lib/pq`                        |
| –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è         | `golang-jwt/jwt/v5`            |
| –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ             | `bcrypt`, `PGP`, `HMAC-SHA256` |
| Email                  | `gomail.v2`                    |
| XML/SOAP               | `beevik/etree`                 |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ            | `logrus`                       |

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏—á–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ)

- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 2FA –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π  
- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Å—á–µ—Ç–æ–≤

---

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–æ–ª—å–∫–æ –≤–∞–ª—é—Ç—ã **RUB**
- –ü—Ä–æ–≥–Ω–æ–∑ –±–∞–ª–∞–Ω—Å–∞ –º–∞–∫—Å–∏–º—É–º –Ω–∞ **365 –¥–Ω–µ–π**

---